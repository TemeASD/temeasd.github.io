<!DOCTYPE HTML>
<!--
	Industrious by TEMPLATED
	templated.co @templatedco
	Released for free under the Creative Commons Attribution 3.0 license (templated.co/license)
-->
<html>

<head>
    <title>Teemu Pölkki - TeamAPP</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.10/css/all.css" integrity="sha384-+d0P83n9kaQMCwj8F4RJB66tzIwOKmrdb46+porD/OvrJ+37WqIM7UoBtwHO6Nlg"
        crossorigin="anonymous">
    <link rel="icon" type="image/x-icon" href="/favicon.png" />
    <link rel="stylesheet" href="assets/css/prism.css" />


</head>

<body class="is-preload">
    <!-- Header -->
    <header id="header">
        <a class="logo" href="#">Portfolio - Kyytiin</a>
        <nav>
            <a href="#menu">Valikko</a>
        </nav>
    </header>

    <!-- Nav -->
    <nav id="menu">
        <ul class="links">
            <li>
                <a href="portfolio.html">Portfolio</a>
            </li>
            <li>
                <a href="index.html">About me</a>
            </li>
        </ul>
    </nav>

    <!-- Banner
			<section id="banner">
				<div class="inner">
					<h1>Industrious</h1>
					<p>A responsive business oriented template with a video background<br />
					designed by <a href="https://templated.co/">TEMPLATED</a> and released under the Creative Commons License.</p>
				</div>
			</section>
 -->
    <!-- Highlights -->
    <section class="wrapper">
        <div class="inner">
            <header class="special">
    
                <a target="_blank" href="https://kyyti.in"> <h2>Kyyti.in</h2></a>
                <div class="content">
                    <header>
                        <a href="#">
                            <img class="logot" src="images/kyyti.png" alt="ag logo">
                        </a>
                    </header>
                    <p>Kyyti.in on uuden ajan kimppakyytipalvelu, joka tekee kimppakyytien sopimisesta todella helppoa ja kätevää.</p><br/>
                        <h2>HANKITTU OSAAMINEN JA STATSIt</h2>
                </div>
            </header>
            <div class="highlights">
                <section>
                    <div class="content">
                        <div>
                            <header>
                                <h3>Frontend</h3>
                                <img class="logot" src="images/angular.png" alt="teamapp logo">
                                <h4>Angular 5</h4>
                            </header>
                        <h4>Hankittu osaaminen</h4>
                        <div class="taulukko">
                            <ul>
                                <li>Työskentely produktiossa</li>
                                <li>Asynkroninen ohjelmointi</li>
                                <li>Lomakkeet ja validointi</li>
                                <li>UI/UX Design</li>
                                <li>Responsiivinen webdesign</li>
                            </ul>
                        </div>
                        <h4>Syvennetty osaaminen</h4>
                        <div class="taulukko">
                            <ul>
                                <li>Angularin perusteet</li>
                                <li>Autentikaatio</li>
                                <li>CSS3, HTML5, Flexbox</li>
                            </ul>
                        </div>
                        </div>
                    </div>
                </section>
                <section>
                    <div class="content">
                            <header>
                                <h3>Backend</h3>
                                <img class="logot" src="images/nodejs.png" alt="nodejs logo">
                                <h4>Node.JS</h4>
                            </header>
                        <h4>Hankittu osaaminen</h4>
                        <div class="taulukko">
                            <ul>
                                <li>Työskentely produktiossa</li>
                                <li>Asynkroninen REST rajapinta</li>
                                <li>Virheenkäsittely</li>
                            </ul>
                        </div>
                        <h4>Syvennetty osaaminen</h4>
                        <div class="taulukko">
                            <ul>
                                <li>CRUD reitit</li>
                                <li>Virheenkäsittely</li>
                                <li>Autentikaatio</li>
                            </ul>
                        </div>
                    </div>
                </section>
                <section>
                    <div class="content">
                            <header>
                                <h3>Tietokanta</h3>
                                <img class="logot" src="images/mariadb.webp" alt="mongo logo">
                                <h4>MariaDB</h4>
                            </header>
                        <h4>Hankittu osaaminen</h4>
                        <div class="taulukko">
                            <ul>
                                <li>Työskentely produktiossa</li>
                                <li>MariaDB</li>
                                <li>Sequelize framework</li>
                            </ul>
                        </div>
                        <h4>Syvennetty osaaminen</h4>
                        <div class="taulukko">
                            <ul>
                                <li>ER-mallinnus ja transformointi</li>
                                <li>Tietokannan luominen</li>
                                <li>SQLn perusteet</li>
                            </ul>
                        </div>
                    </div>
                </section>
            </div>
            <div class="highlights">
                <section>
                    <div class="content">
                        <div>
                            <header>
                                <h3>Versionhallinta</h3>
                                <img class="logot" src="images/git.png" alt="git logo">
                                <h4>GIT</h4>
                            </header>
                        <h4>Syvennetty osaaminen</h4>
                        <div class="taulukko">
                            <ul>
                                <li>GITin perusteet</li>
                                <li>GitLabin käyttö</li>
                                <li>Merge konfliktien selvittely</li>
                            </ul>
                        </div>
                        </div>
                    </div>
                </section>
                <section>
                    <div class="content">
                            <header>
                                <h3>Käytetyt ohjelmistot</h3>
                                <img class="logot" src="images/software.png" alt="software logo">
                                <h4>&#8203;</h4>
                            </header>
                            <h4>Syvennetty osaaminen</h4>
                        <div class="taulukko">
                            <ul>
                                <li>PowerShell</li>
                                <li>VS Code</li>
                                <li>GIT Bash</li>
                                <li>Ubuntu 16.04</li>
                                <li>Nginx</li>
                                <li>NPM</li>
                                <li>PuTTy & WinSCP</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <section>
                    <div class="content">
                            <header>
                                <h3>STATSIT</h3>
                                <img class="logot" src="images/stats.jpg" alt="123 logo">
                                <h4>&#8203;</h4>
                            </header>
                            <h4>Työt</h4>
                        <div class="taulukko">
                            <ul>
                                <li>Neljä kuukautta</li>
                                <li>Yhteensä yli 800 työtuntia</li>
                                <li>367 committia</li>
                                <li>3103 riviä TypeScriptiä</li>
                                <li>1369 riviä JavaScriptiä</li>
                                <li>1176 riviä HTML:ää</li>
                                <li>Yhteensä 6696 riviä koodia</li>
                            </ul>
                        </div>
                        <h4>Käyttäjät</h4>
                        <div class="taulukko">
                            <ul>
                                <li>~100 rekisteröitynyttä käyttäjää</li>
                                <li>~300 istuntoa</li>
                                <li>3 ilmoitettua kyytiä</li>
                            </ul>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </section>
    <!--PORTFOLIO CONTENT -->
    <!--FRONTEND-->
    <section id="main" class="wrapper">
        <div class="inner">
            <div class="content" id="angular">
                <h3>Esisanat</h3>
                <blockquote>Tämä on toinen web applikaatio jonka parissa työskennellyt.</blockquote>
                <blockquote>Projektissa oli tarkoituksena luoda palvelu, jossa käyttäjät voivat luoda ja järjestellä itselleen kimppakyytejä. Palvelua voidaan käyttää sekä www-selaimen että mobiilisovelluksen kautta. Tarkoituksena oli, että sovelluksen käyttö olisi mahdollisimman helppoa.</blockquote>
                <p>OOlin projektissa käytännössä joka paikan höylä. Projektin alussa pyörittelin meille ER-mallin, transformoin sen ja tein siitä SQL skriptin. Suuri osa isoista päätöksistä, kuten teknologiat, lopullinen tietokantamalli ja arkkitehtuuri kuitenkin soviteltiin yhdessä tiimikaverini Mika Tonterin kanssa. Alkuun pääsemisen jälkeen tein kuitenkin jonkin verran enemmän frontendiä. Tein esimerkiksi profiilisivun, authdialogin, ja todennäköisesti kaikki applikaatiosta löytyvät lomakkeet ainakin kahteen kertaan (kyydin luominen, kirjautuminen, rekisteröityminen, puhelinnumeron vaihto). Tämän lisäksi kuvasin, ohjasin ja käsikirjoitin projektin aikana myös 
                    <a target="_blank" href="https://www.youtube.com/watch?v=PFZiXJvzUyE">mainosvideon</a> jonka ensi-ilta oli 28.3.2018. Backendiin tein käytännössä aivan normaaleita CRUD reittejä, mutta mukaan mahtui myös muutama haastavampi ongelma, joista yhden ratkaisu on tulossa vastaan alhaalla.
                </p>
                <p>
                        Osaamisen todistamiseksi näytän tässä pääosin arvostelun toteutusta. Se on hyvä esimerkki, koska se on 99% implementoimani ja se ominaisuus koskettaa stäkin jokaista kohtaa. Lisäksi kerron hieman myös siitä, kuinka applikaatio on konfiguroitu produktioon.
                </p>
                <section>
                    <h3>Yleiskatsaus arvosteluun</h3>
                        <!--life of a ridecreate data-->
                        <div class="btn-holder">
                            <button class="btn-left button" onclick="plusDivs(-1)">&#10094;</button>
                            <div class="nmb-holder">
                                <div class="slideshow_picture_numbers">
                                    <span class="active_slideshow_picture_number">1</span>
                                    <span class="passive_slideshow_picture_number">2</span>
                                    <span class="passive_slideshow_picture_number">3</span>
                                    <span class="passive_slideshow_picture_number">4</span>
                                </div>
                                <div class="slideshow_picture_numbers">                                        
                                    <span class="passive_slideshow_picture_number">1</span>
                                    <span class="active_slideshow_picture_number">2</span>
                                    <span class="passive_slideshow_picture_number">3</span>
                                    <span class="passive_slideshow_picture_number">4</span>
                                </div>
                                <div class="slideshow_picture_numbers">
                                    <span class="passive_slideshow_picture_number">1</span>
                                    <span class="passive_slideshow_picture_number">2</span>
                                    <span class="active_slideshow_picture_number">3</span>
                                    <span class="passive_slideshow_picture_number">4</span>
                                </div>
                                <div class="slideshow_picture_numbers">
                                    <span class="passive_slideshow_picture_number">1</span>                                        
                                    <span class="passive_slideshow_picture_number">2</span>
                                    <span class="passive_slideshow_picture_number">3</span>
                                    <span class="active_slideshow_picture_number">4</span>
                                </div>
                            </div>
                            <button class="btn-right button" onclick="plusDivs(+1)">&#10095;</button>
                        </div>
                        <div class="slideshow_pictures image fit">
                             <figcaption>1. Käyttäjää ei ole vielä arvosteltu (ja käyttäjä ei voi arvostella tätä käyttäjää)</figcaption>
                            <img src="images/kyytiin/life_of_data/not_reviewed.PNG" alt="Kyyti.in websovelluksen kyytisivu"/>
                        </div>
                        <div class="slideshow_pictures image fit">
                            <figcaption>2. Käyttäjä voi arvostella toisen</figcaption>
                            <img src="images/kyytiin/life_of_data/can_review.PNG" alt="Kyyti.in websovelluksen kyytisivu"/>
                        </div>
                        <div class="slideshow_pictures image fit">
                            <figcaption>3. Arvosteluprosessi on käynnissä</figcaption>
                            <img src="images/kyytiin/life_of_data/reviewing.PNG" alt="Kyyti.in websovelluksen kyytisivu"/>
                        </div>
                        <div class="slideshow_pictures image fit">
                            <figcaption>4. Käyttäjä on arvosteltu, ja arvio haetaan tietokannasta</figcaption>
                            <img src="images/kyytiin/life_of_data/reviewed.PNG" alt="Kyyti.in websovelluksen kyytisivu"/>
                        </div>
                        </span>
                        <!--life of a ridecreate data
                        <span class="image fit">
                            <img src="images/kyytiin/frontpage.PNG" alt="Kyyti.in websovelluksen kyytisivu" />
                        </span>-->
                <h3>Kuinka arvosteluoikeus jaetaan?</h3>
                <div class="btn-holder">
                    <button class="btn-left button" onclick="plusDivs2(-1)">&#10094;</button>
                        <div class="nmb-holder">
                            <div class="code_picture_numbers">
                                <span class="active_slideshow_picture_number">1</span>
                                <span class="passive_slideshow_picture_number">2</span>
                                <span class="passive_slideshow_picture_number">3</span>
                            </div>
                            <div class="code_picture_numbers">                                        
                                <span class="passive_slideshow_picture_number">1</span>
                                <span class="active_slideshow_picture_number">2</span>
                                <span class="passive_slideshow_picture_number">3</span>
                            </div>
                            <div class="code_picture_numbers">
                                <span class="passive_slideshow_picture_number">1</span>
                                <span class="passive_slideshow_picture_number">2</span>
                                <span class="active_slideshow_picture_number">3</span>
                            </div>
                        </div>
                    <button class="btn-right button" onclick="plusDivs2(+1)">&#10095;</button>
                </div>
                <div class="slideshow_code">
                        <figcaption>Mitä: Kutsutaan allowReview funktiota joka kutsuu review serviceä</figcaption>
                        <figcaption>Tiedosto: userdetails.component.ts</figcaption>
                        <figcaption>Paikka: frontend</figcaption>    
                          <pre>
                            <code class="language-javascript">
<!--JS 1. -->
ngOnInit() {
    this.canReview = false;
    this.customer_id = this.route.snapshot.paramMap.get('customer_id');
    this.allowReview();
    this.createForm();
}
                                
allowReview() {
    this.reviewService.allowReview(this.customer_id, this.localAuthService.decodeToken())
      .then(response => this.canReview = true)
      .catch((err) => {
        console.error('allowReview epäonnistui: ' + err.message)
      });
}
<!--JS-->
                        </code>
                    </pre>
                </div>
                <div class="slideshow_code">
                        <figcaption>Mitä: allowReview omassa elementissään</figcaption>
                        <figcaption>Tiedosto: review.service.ts</figcaption>
                        <figcaption>Paikka: frontend</figcaption>    
                    <pre>
                        <code class="language-javascript">
<!--JS 1. -->
allowReview(user, user2) {
    let response = new Promise((resolve, reject) => {
      this.http.get(`${environment.apiUrl}/review/canReview/${user}/${user2}`)
        .toPromise()
        .then(
          data => {
            resolve(data);
          },
          err => {
            reject(err);
          })
    })
    return response;
}
<!--JS-->
                        </code>
                    </pre>
                </div>
                <div class="slideshow_code">
                    <figcaption>Mitä: Pitkä ja ei niin elegantti funktio siitä, miten arvosteluoikeus jaetaan</figcaption>
                    <figcaption>Tiedosto: reviewcontroller.js</figcaption>
                    <figcaption>Paikka: backend</figcaption>    
                <pre>
                        <code class="language-javascript">
    <!--JS 1. -->
/*
Tämä funktio palauttaa joko 403 tai 200. Jos 200 käyttäjä voi arvostella
Tarkoituksena on päätellä voiko kyytiläinen tai kyydin luoja arvostella toinen toistaan
Ensimmäisessä queryssä etsitään parametreinä tulleiden käyttäjä ideidenä perusteella
Onko arvoilla yhteys tietokannassa CustomersRides_ride taulun kautta
Toisessa queryssä tarkastellaan toisinpäin 
TODO: Refaktoroi käyttämään yhtä queryä
*/
exports.canReview = (req, res, next) => {
    //Jos palauttaa arvoja, kyydin luoja voi arvostella kyytiläisiä
    Review.sequelize.query('
    SELECT r.ride_id, r.customer_id AS creator_customer_id, CRr.customer_id AS joiner_customer_id 
    FROM Rides r INNER JOIN CustomersRides_ride CRr ON r.ride_id = CRr.ride_id 
    WHERE r.customer_id = :creator_customer_id AND CRr.customer_id = :joiner_customer_id',
		{
            replacements: 
            { 
                creator_customer_id: req.params.creator_customer_id, 
                joiner_customer_id: req.params.joiner_customer_id 
            },
			type: Review.sequelize.QueryTypes.SELECT
		})
		.then(data => {
			//Jos edellinen query ei palauttanut mitään, mennään seuraavaan ja etsitää sieltä
			if (data.length === 0) {
				//Jos query palauttaa arvoja, kyytiläinen voi arvostella luojaa
                Review.sequelize.query('
                SELECT CRr.ride_id, CRr.customer_id AS joiner_customer_id, r.customer_id AS creator_customer_id 
                FROM CustomersRides_ride CRr INNER JOIN Rides r on CRr.ride_id = r.ride_id 
                WHERE r.customer_id = :creator_customer_id AND CRr.customer_id = :joiner_customer_id',
					{
                        replacements: 
                        {   //ID:t ovat väärinpäin täysin hämärästä syystä
                            //Toimii näinpäin ja testattu ulostulevan datan olevan oikeaa
                            //kaikissa skenaaroissa
                            creator_customer_id: req.params.joiner_customer_id, 
                            joiner_customer_id: req.params.creator_customer_id
                        },
                        type: Review.sequelize.QueryTypes.SELECT
                    })
                    .then(data2 => {
                        if (data2.length === 0) {
                            res.status(403).json({
                                message: 'You are not able to review'
                            })
                        } else {
                            res.status(200).json({
                                message: 'Proceed'
                            });
                        }
                    })
                    .catch(err => console.log(err));
            } else {
                res.status(200).json({
                    message: 'Proceed'
                });
            }
        })
        .catch(err => console.log(err))
};
        <!--JS-->
                        </code>
                    </pre>
                </div>
    
            <!--Create review-->
            <div class>
                <h3>Arvostelun luominen</h3>
                <div class="btn-holder">
                    <button class="btn-left button" onclick="plusDivs4(-1)">&#10094;</button>
                        <div class="nmb-holder">
                            <div class="createReview_picture_numbers">
                                <span class="active_slideshow_picture_number">1</span>
                                <span class="passive_slideshow_picture_number">2</span>
                                <span class="passive_slideshow_picture_number">3</span>
                                <span class="passive_slideshow_picture_number">4</span>

                            </div>
                            <div class="createReview_picture_numbers">                                        
                                <span class="passive_slideshow_picture_number">1</span>
                                <span class="active_slideshow_picture_number">2</span>
                                <span class="passive_slideshow_picture_number">3</span>
                                <span class="passive_slideshow_picture_number">4</span>
                            </div>
                            <div class="createReview_picture_numbers">
                                <span class="passive_slideshow_picture_number">1</span>
                                <span class="passive_slideshow_picture_number">2</span>
                                <span class="active_slideshow_picture_number">3</span>
                                <span class="passive_slideshow_picture_number">4</span>

                            </div>
                            <div class="createReview_picture_numbers">
                                <span class="passive_slideshow_picture_number">1</span>
                                <span class="passive_slideshow_picture_number">2</span>
                                <span class="passive_slideshow_picture_number">3</span>
                                <span class="active_slideshow_picture_number">4</span>
                            </div>
                        </div>
                    <button class="btn-right button" onclick="plusDivs4(+1)">&#10095;</button>
                </div>
                <div class="slideshow_createReview">
                        <figcaption>Mitä: Arvostelulomakkeen template</figcaption>
                        <figcaption>Tiedosto: userdetails.component.html</figcaption>
                        <figcaption>Paikka: frontend</figcaption>    
                    <pre>
                        <code class="language-html">
                            <xmp>
<mat-card *ngIf="canReview">
    <mat-card-title>Arvioi käyttäjä:</mat-card-title>
    <form [formGroup]="reviewForm" (ngSubmit)="sendReview(reviewForm.value)">
        <div class="stars">
            <star-rating-comp 
            fxLayoutAlign="start center" 
            [hoverEnabled]="true" 
            [speed]="'immediately'" 
            [size]="'large'" 
            [starType]="'svg'"
            formControlName="stars"></star-rating-comp>
        </div>
        <mat-form-field>
            <input matInput #review_text id="review_text" name="review_text" formControlName="review_text" placeholder="Lisätiedot">
            <mat-hint>{{review_text.value.length}} / 512</mat-hint>
        </mat-form-field>
        <div>
            <button [disabled]="reviewForm.invalid" mat-raised-button color="primary" (click)="refresh()">Anna arvio!</button>
        </div>
    </form>
</mat-card>                                    
                            </xmp>
                        </code>
                    </pre>
                </div>
                <div class="slideshow_createReview">
                    <figcaption>Mitä: Skriptit arvostelun luomista varten</figcaption>
                    <figcaption>Tiedosto: userdetails.component.ts</figcaption>
                    <figcaption>Paikka: frontend</figcaption>    
                    <pre>
                        <code class="language-javascript">
                            <xmp>
createForm() {
    this.reviewForm = this.fb.group({
      stars: ['', Validators.compose([Validators.required, Validators.min(1), Validators.max(5)])],
      review_text: ['', Validators.maxLength(512)],
      customer_id: [this.customer_id],
    });
}
                                    
let reviewForm = 
{
    'stars': 4,
    'review_text': 'Minun mielestäni hyvä kyyti',
    'customer_id': 'UUIDV4',
}

sendReview(reviewForm) {
    this.reviewService.sendReview(reviewForm)
      .then(response => console.log('ok'))
      .catch((err) => {
        this.errorUiService.popErrorDialog(err);
        console.error('sendReview epäonnistui: ' + err.message)
      });
}
                            </xmp>
                        </code>
                    </pre>
                </div>
                <div class="slideshow_createReview">
                    <figcaption>Mitä: Skriptit arvostelun luomista varten</figcaption>
                    <figcaption>Tiedosto: review.service.ts</figcaption>    
                    <figcaption>Paikka: frontend</figcaption>    
                    <pre>
                        <code class="language-javascript">
                            <xmp>
sendReview(reviewForm) {
  let response = new Promise((resolve, reject) => {
    this.http.post(`${environment.apiUrl}/review/${reviewForm.customer_id}`, reviewForm)
      .toPromise()
      .then(
        data => {
          resolve(data);
        },
        err => {
          reject(err);
        })
  })
  return response;
}
                            </xmp>
                        </code>
                    </pre>
                </div>
                <div class="slideshow_createReview">
                    <figcaption>Mitä: Skriptit arvostelun luomista varten</figcaption>
                    <figcaption>Tiedosto: reviewcontroller.js</figcaption>  
                    <figcaption>Paikka: backend</figcaption>    
                    <pre>
                        <code class="language-javascript">
                            <xmp>
exports.createReview = (req, res, next) => {
    const data = {
        stars: req.body.stars,
        review_text: req.body.review_text,
        customer_id: req.body.customer_id,
    };
    Review.create(data)
        .then((ride) => {
            res.status(200).json({
                message: 'Review created',
                data: data
            });
        })
        .catch((err) => {
            console.log(err)
        })
};
                            </xmp>
                        </code>
                    </pre>
                </div>    
            </div>
                    <h3>Arvostelun tietokantarakenne</h3>
                    <div class="btn-holder">
                            <button class="btn-left button" onclick="plusDivs3(-1)">&#10094;</button>
                            <div class="nmb-holder">
                                <div class="sql_picture_numbers">
                                    <span class="active_slideshow_picture_number">1</span>
                                    <span class="passive_slideshow_picture_number">2</span>
                                </div>
                                <div class="sql_picture_numbers" style="display:none;">                                        
                                    <span class="passive_slideshow_picture_number">1</span>
                                    <span class="active_slideshow_picture_number">2</span>
                                </div>
                            </div>
                            <button class="btn-right button" onclick="plusDivs3(+1)">&#10095;</button>
                        </div>
                <div class="slideshow_sql">
                    <figcaption>Mitä: Koko SQL skripti</figcaption>
                    <pre>
                        <code class="language-sql">
                            <!--tähän-->
CREATE DATABASE IF NOT EXISTS kyyti;
USE kyyti;

DROP TABLE IF EXISTS CustomersRides_ride;
DROP TABLE IF EXISTS CustomersCars;
DROP TABLE IF EXISTS Cars;
DROP TABLE IF EXISTS Reviews;
DROP TABLE IF EXISTS Notifications;
DROP TABLE IF EXISTS Requests;
DROP TABLE IF EXISTS Rides;
DROP TABLE IF EXISTS Customers;


CREATE TABLE IF NOT EXISTS Customers (
);

CREATE TABLE IF NOT EXISTS Rides (
);

CREATE TABLE IF NOT EXISTS Requests (
);

CREATE TABLE IF NOT EXISTS Notifications (
);

CREATE TABLE IF NOT EXISTS Reviews (
  review_id VARCHAR(100) NOT NULL PRIMARY KEY, 
  customer_id VARCHAR(100) NOT NULL,
  stars TINYINT NOT NULL,
  review_text VARCHAR(600),
  review_created DATETIME default CURRENT_TIMESTAMP,
  FOREIGN KEY(customer_id) REFERENCES Customers(customer_id)
    ON UPDATE RESTRICT ON DELETE RESTRICT
);

CREATE TABLE IF NOT EXISTS Cars ( 
);

CREATE TABLE IF NOT EXISTS CustomersCars (
);

CREATE TABLE IF NOT EXISTS CustomersRides_ride (
);

                    </code>
                </pre> 
            </div>
            <div class="slideshow_sql">
                    <figcaption>Mitä: Review taulun Sequelize model</figcaption>
                    <figcaption>Tiedosto: review.js</figcaption>
                    <figcaption>Paikka: backend</figcaption>    

                    <pre>
    <code class="language-javascript">
const db = require('./index');

module.exports = (sequelize, DataTypes) => {
    let Review = sequelize.define('Review', {
        review_id: {
            type: DataTypes.UUID,
            defaultValue: DataTypes.UUIDV4,
            allowNull: false,
            primaryKey: true
        },
        customer_id: {
            type: DataTypes.UUID,
            defaultValue: DataTypes.UUIDV4,
            allowNull: false,
            foreignKey: true
        },
        stars: {
            type: DataTypes.TINYINT
        },
        review_text: {
            type: DataTypes.STRING
        },
        review_created: {
            type: DataTypes.DATE,
            defaultValue: DataTypes.NOW,
        },
    },
        {
            timestamps: false,
            tableName: 'Reviews',
            freezeTableName: true,
        });

    return Review;
};
                            </code>
                        </pre>
                    </div>
            </div>
        </section>
                <!--BACKEND-->
        <section id="main" class="wrapper">
            <div class="inner">
                <div class="content" id="nodejs">
                    <h3>Muut näytettävät artefaktit</h3>
                    <div>
                    <h4>getUserMadeRides</h4>
                    <p>Minulle suotiin armollisesti taski, jossa pyydettiin hakemaan käyttäjälle hänen kyytisivulleen kyytiin liittyneet käyttäjät. Kyseinen funktio tekee ensin kyselyn jossa etsitään tietyn käyttäjän tiettyyn kyytiin liittyvät muut käyttäjät. Tämän jälkeen haetaan itse kyyti taulun tiedot (nämä halutaan palauttaa aina). Jos aikaisemmassa kyselyssä käyttäjiä löytyi, haetaan tämän jälkeen heidän tietonsa. 
                        <br/>
                        Sequelize palauttaa datan JSONina, mutta haluaa vastaanottaa parametrit operaatioihin taulukoina, joten pyöräytin for loopin, joka työntää
                        JSON-taulukon tiedot taulukkoon jolla varsinainen haku sitten suoritetaan. Hakuun käytetään Sequelizen 'in' operaattoria jonka 
                        toimintaperiaate vastaa SQL:n IN operaattoria. 
                    </p>
                    <figcaption>Mitä: Funktio jolla haetaan käyttäjän tekemä kyyti, ja sille liittyneet käyttäjät (jos niitä on)</figcaption>
                    <figcaption>Tiedosto: ridecontroller.js</figcaption>  
                    <figcaption>Paikka: backend</figcaption>    
                        <pre>
                            <code class="language-javascript">
exports.getUserMadeRides = (req, res, next) => {
  //etsitään Rides taulusta ridejoinereita, innerjoinin avulla. 
  Ride.sequelize.query(
  SELECT CRr.customer_id AS joiner_id FROM Rides r 
  INNER JOIN CustomersRides_ride CRr on r.ride_id = CRr.ride_id 
  WHERE r.ride_id = :ride_id AND r.customer_id = :customer_id;,
    {
      replacements: { ride_id: req.params.ride_id, customer_id: req.params.customer_id },
      type: Ride.sequelize.QueryTypes.SELECT
    })
    .then(riders => {
      Ride.find({
        where: { ride_id: req.params.ride_id }
      })
        //haetaan käyttäjät
        .then(ride => {
          //Työnnetään ridersit json taulukosta #oikeaan taulukkoon
          //Sequelize haluaa taulukoita [Op.in] operaatioon 
          var i;
          var joiners = [];
          for (i = 0; i < riders.length; i++) {
            joiners.push(riders[i].joiner_id);
          }
          //Jos taulukko jäi tyhjäksi (eli kyytiläisiä ei ollut), lähetetään pelkän kyydin tiedot
          if (joiners.length > 0) {
            User.findAll({
              attributes: ['firstName', 'lastName', 'email', 'phoneNumber', 'customer_id'],
              where: {
                Customer_id: {
                  [Op.in]: [joiners]
                }
              }
            })
              .then(joiners => {
                res.status(200).json({
                  message: 'Ride and joiners found',
                  ride: ride,
                  joiners: joiners
                })
              })
          } else {
            res.status(200).json({
              message: 'Ride found',
              ride: ride
            })
          }
        })
    })
    .catch((err) => console.log('getUserJoinedRides failed: ' + err.message));
};
                             </code>
                         </pre>
                     </div>
                     <div>
                        <h4>Web App Manifest</h4>
                        <p>Koska Kyyti.in on moderni progressiivinen web applikaatio, meidän piti tehdä web manifest tiedosto. Sitä käytetään web applikaatioiden
                            asentamiseen laitteeseen. Oli se sitten tietokone tai älypuhelin. Tällaisen web manifestin avulla Google Chromea käyttävältä 
                            kävijältä kysytään suoraan haluaako hän asentaa applikaation puhelimeensa. Koska meillä on rekisteröity service worker, asentuu 
                            web applikaatiomme "natiivisti" Android puhelimille. Applikaatio näkyy sovellukset listauksessa ja toimii kuten natiivi applikaatio toimisi. 
                        </p>
                        <figcaption>Mitä: Webmanifest tiedosto jota käytetään web applikaatioiden asentamiseen käyttäjän laitteeseen</figcaption>
                        <figcaption>Tiedosto: manifest.webmanifest</figcaption>  
                        <figcaption>Paikka: frontend</figcaption>    
                            <pre>
                                <code class="language-json">
{
    "short_name": "Kyyti.in",
    "name": "Kyyti.in",
    "description": "Uuden ajan kimppakyytipalvelu",
    "background_color": "#fff",
    "theme_color": "#689F38",
    "icons": [
        {
            "src": "favicon.ico",
            "sizes": "32x32",
            "type": "image/png"
        },
        {
            "src": "/assets/images/android-chrome-192x192.png",
            "sizes": "192x192",
            "type": "image/png"
        },
        {
            "src": "/assets/images/kyytiin-512.png",
            "sizes": "512x512",
            "type": "image/png"
        }
    ],
    "start_url": "/index.html",
    "display": "standalone",
    "orientation": "portrait"
}                               </code>
                            </pre>
                        </div>
                        <div>
                            <h4>Konfiguraatio produktioon</h4>
                            <h5>1. Angular</h5>
                            <p>Käytämme perinteiseen tyyliin ympäristömuuttujia build prosessia ja produktioon työntämisen helpottamiseksi. 
                                Tapa jolla näitä käytämme, on melko yksiselitteinen. Ensimmäisessä upotteessa olevaa scriptiä kutsutaan komentoriviltä, 
                                jolloin työkalu valitsee muuttujiksi produktio versiot. </p>
                            <p>
                            <h5>2. .env</h5>
                                .env tiedostoa käytettäessä asetetaan jokaiselle ympäristölle henkilökohtainen .env tiedosto kansiorakenteen juureen. 
                                Esimerkissä on lokaalin kehitysympäristön .env tiedosto.
                            </p>
                            <div class="btn-holder">
                                <button class="btn-left button" onclick="plusDivs5(-1)">&#10094;</button>
                                <div class="nmb-holder">
                                    <div class="produktio_picture_numbers">
                                        <span class="active_slideshow_picture_number">1</span>
                                        <span class="passive_slideshow_picture_number">2</span>
                                    </div>
                                    <div class="produktio_picture_numbers" style="display:none;">  
                                        <span class="passive_slideshow_picture_number">1</span>
                                        <span class="active_slideshow_picture_number">2</span>
                                    </div>
                                </div>
                                <button class="btn-right button" onclick="plusDivs5(+1)">&#10095;</button>
                            </div>        
                            <div class="slideshow_produktio">
                                    <figcaption>Mitä: Angularin build prosessin käyttämät muuttujat</figcaption>
                                    <figcaption>Tiedosto: package.sjon, environment.ts ja environment.prod.ts</figcaption>  
                                    <figcaption>Paikka: frontend (buildatessa)</figcaption>                
                                <pre>
                                    <code class="language-json">
"scripts": { "build": "ng build --prod -aot --env=prod" }
                                    </code>
                                    <code class="language-javascript">
export const environment = {
    production: false,
    apiUrl: 'http://localhost:3000/api',
    serverUrl: 'http://localhost:3000'
};

export const environment = {
    production: true,
    apiUrl: 'https://app.kyyti.in/api',
    serverUrl: 'https://app.kyyti.in'
};
                                    </code>
                                </pre>
                            </div>
                            <div class="slideshow_produktio" style="display:none;">
                                <figcaption>Mitä: .env muuttuja, jota käytetään konfiguroimiseen tiettyyn ympäristöön</figcaption>
                                <figcaption>Tiedosto: .env ja config.js</figcaption>  
                                <figcaption>Paikka: backend (tietokantakonffit)</figcaption>                
                                <pre>
                                    <code class="language-ini">
DB_USER=root
DB_PASSWORD=Kyyti.in.DB
DB_DATABASE=kyyti
DB_HOST=localhost
DB_DIALECT=mysql
PORT=3000
JWT_SECRET=secret
MAILER_USER=kyytiinapp.noreply@gmail.com
MAILER_PASSWORD=password
MAILER_SERVICE_PROVIDER=Gmail
                                    </code>
                                    <code class="language-javascript">

module.exports = {
    development: {
      username: process.env.DB_USER,
      password: process.env.DB_PASSWORD,
      database: process.env.DB_DATABASE,
      host: process.env.DB_HOST,
      dialect: "mysql"
}
                                    </code>
                                </pre>
                            </div>
                        </div>
                        <div>
                            <h4>Angular service worker</h4>
                            <p>Angularin mukana on tullut sen oma service worker versiosta 5.0.0 asti. Sen käyttöön ottoon
                                riittää "ngsw-config.json" tiedoston luominen ja konfiguroiminen. Konfiguraatio on muuten hyvin simppeli 
                                ja valmiilta pohjalta rakennettu, mutta olemme lisänneet sinne joka hakee FontAwesomen fontit sekä noutaa assettimme
                                heti sivustolle saavuttaessa. Tämä kuluttaa vähän dataa koska assettimme ovat pieniä, suurena hyötynä on applikaation
                                sulava käyttö heti ensilatauksesta asti. <br />
                                Toisena isona asiana on käyttäjäprofiilin profiilikuvan lataus. Ne ladataan tarvittaessa ja säilötään cacheen kunnes tiedostoon
                                tapahtuu muutoksia. Tiedostoja ei laiskan latauksen takia päivitetä esimerkiksi hitaan internetin takia. 
                              </p>
                            <figcaption>Mitä: Angularin service workerin konfiguraatiotiedosto</figcaption>
                            <figcaption>Tiedosto: ngsw-config.json</figcaption>  
                            <figcaption>Paikka: frontend</figcaption>                
                            <pre>
                                <code class="language-json">
{
    "index": "/index.html",
    "assetGroups": [
        {
            "name": "Kyyti.in",
            "installMode": "prefetch",
            "resources": {
                "files": [
                    "/favicon.ico",
                    "/index.html"
                ],
                "versionedFiles": [
                    "/*.bundle.css",
                    "/*.bundle.js",
                    "/*.chunk.js"
                ],
                "urls": [
                    "https://use.fontawesome.com/releases/v5.0.8/css/all.css"
                ]
            }
        },
        {
            "name": "assets",
            "installMode": "prefetch",
            "updateMode": "prefetch",
            "resources": {
                "files": [
                    "/assets/**"
                ]
            }
        },
        {
            "name": "public images",
            "installMode": "lazy",
            "updateMode": "lazy",
            "resources": {
                "files": [
                    "/public/images/**"
                ]
            }
        }
    ]
}
                                </code>
                            </pre>
                        </div>
                    </div>
            </div>
        </section>
            
        <section id="main" class="wrapper">
            <div class="inner">
                <div class="content" id="reflektointi">
                    <h3>Reflektointi</h3>
                    <p>Selailin redditistä /r/learnprogramming subreddittiä, ja törmäsin seuraavanlaiseen määritelmään ohjelmointiosaamisen tasoista</p>
                    <ul>
                        <li>1. Osaa tehdä tutoriaalien perusteella</li>
                        <li>2. Osaa kirjoittaa koodia tutoriaalien perusteella ja turvautuu lähes kaikessa Googleen</li>
                        <li>3. Osaa kirjoittaa jotain itse, ja joissain turvautuu tutoriaaleihein sekä dokumentaatioon ja Googleen</li>
                        <li>4. Osaa kirjoittaa itse ja turvautuu dokumentaatioon ja Googleen</li>
                        <li>5. Kirjoittaa tutoriaalit</li>
                    </ul>
                    <p>En tiedä onko listaus kuinka tarkka tai hyvä, mutta mielestäni se kuulostaa järkeväänkäyvältä. Verratessa itseäni tuohon listaukseen,
                         kokisin joissain asioissa olevani tasolla 2, ja joissain asioissa tasolla 3 ja 4. Ennen tätä projektia olin suurimmassa osassa asioita tasolla 2. 
                    </p>
                    <p>Tämä usean kuukauden stressaava, jopa välillä crunchiin verrattavissa oleva jakso, opetti
                        paljon tehokkaasta ohjelmoinnista ja kuinka ominaisuudet saadaan nopeasti valmiiksi. Aikataulun ja
                        työmäärän takia teoreettinen osuus jäi paljon pienemälle ja tietynlainen syväoppiminen sekä sataprosenttinen
                        ymmärrys uusista asioista jäi puuttumaan.
                        <br/>Kokisin joka tapauksessa tämän projektin jälkeen olevampi paljon valmiimpi ja todella paljon parempi
                        ohjelmoija ja tekniikan tietäjä kuin ennen tätä.
                    </p>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer id="footer">
            <div class="inner">
                <div class="content">
                    <section>
                        <h3>/whois Teemu</h3>
                        <p>Olen 24-vuotias tradenomiopiskelija, opiskelen tietojenkäsittelyn koulutusohjelmaa kolmatta vuotta. Koulun
                                ohella olen tehnyt töitä, mutta nyt keskityn täysin opiskeluun. Vähällä vapaa-ajallani kuuntelen
                                musiikia, ohjelmoin, editoin videoita, ajelen maastopyörällä sekä pelaan videopelejä. Työkokemukseni
                                on laaja, mutta yksikään osio siitä ei ole ohjelmoinnin tai tietotekniikan alalta.</p>                    </section>
                    <section>
                        <h4>Teemu sosiaalisessa mediassa</h4>
                        <ul class="plain">
                            <li>
                                <a target="_blank" href="https://twitter.com/TemeASD">
                                    <i class="icon fa-twitter">&nbsp;</i>Twitter</a>
                            </li>
                            <li>
                                <a target="_blank" href="https://www.linkedin.com/in/teemu-p%C3%B6lkki/">
                                    <i class="icon fa-linkedin">&nbsp;</i>LinkedIn</a>
                            </li>
                        </ul>
                    </section>
                </div>
                <div class="copyright">
                    &copy; Teemu Pölkki 2018 | Template by Untitled.
                </div>
            </div>
        </footer>

        <!-- Scripts -->
        <script src="assets/js/jquery.min.js"></script>
        <script src="assets/js/browser.min.js"></script>
        <script src="assets/js/breakpoints.min.js"></script>
        <script src="assets/js/util.js"></script>
        <script src="assets/js/main.js"></script>
        <script src="assets/js/prism.js"></script>
        <script src="assets/js/carousel.js"></script>
</body>

</html>